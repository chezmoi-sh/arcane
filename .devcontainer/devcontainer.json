/*
 * Copyright (C) 2024 Alexandre Nicolaie (xunleii@users.noreply.github.com)
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *         http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * ----------------------------------------------------------------------------
 */
// Reference:
// - https://containers.dev/features
// - https://containers.dev/implementors/features
// - https://code.visualstudio.com/docs/getstarted/settings
{
	"name": "chezmoi.sh/atlas Codespace",
	"dockerComposeFile": "docker-compose.yaml",
	"service": "vscode",
	"customizations": {
		"vscode": {
			"settings": {
				"dev.containers.copyGitConfig": true,
				"direnv.restart.automatic": true,
				"editor.defaultFormatter": "trunk.io",
				"editor.gotoLocation.multipleDeclarations": "goto",
				"editor.gotoLocation.multipleDefinitions": "goto",
				"editor.gotoLocation.multipleImplementations": "goto",
				"editor.gotoLocation.multipleReferences": "goto",
				"editor.gotoLocation.multipleTypeDefinitions": "goto",
				"editor.minimap.enabled": true,
				"editor.quickSuggestionsDelay": 0,
				"editor.snippetSuggestions": "top",
				"editor.suggestSelection": "first",
				"editor.terminal.integrated.shell.linux": "/usr/bin/zsh",
				"explorer.openEditors.visible": 1,
				"files.associations": {
					".folderinfo": "yaml"
				},
				"files.trimFinalNewlines": true,
				"files.trimTrailingWhitespace": true,
				// Nix IDE configuration
				"nix.enableLanguageServer": true,
				"nix.serverPath": "nil",
				"nix.serverSettings": {
					"nil": {
						"formatting": {
							"command": ["nixfmt"]
						}
					}
				},
				// Additional customizations for specific file types
				"[markdown]": {
					"files.trimTrailingWhitespace": false
				},
				"[nix]": {
					"editor.defaultFormatter": "jnoortheen.nix-ide"
				}
			},
			"extensions": [
				"bierner.github-markdown-preview",
				"bierner.markdown-preview-github-styles",
				"github.copilot",
				"github.vscode-github-actions",
				"GitHub.vscode-pull-request-github",
				"jetmartin.bats",
				"jnoortheen.nix-ide",
				"ldez.ignore-files",
				"mkhl.direnv",
				"ms-azuretools.vscode-docker",
				"ms-kubernetes-tools.vscode-kubernetes-tools",
				"ms-python.python",
				"ms-vscode-remote.remote-containers",
				"nefrob.vscode-just-syntax",
				"redhat.ansible",
				"redhat.vscode-yaml",
				"tamasfe.even-better-toml",
				"terrastruct.d2",
				"tilt-dev.tiltfile",
				"trunk.io",
				"visualstudioexptteam.vscodeintellicode"
			]
		}
	},
	"features": {
		"ghcr.io/devcontainers/features/common-utils:2.5.2": {
			"installZsh": true,
			"configureZshAsDefaultShell": true,
			"installOhMyZsh": true,
			"installOhMyZshConfig": true,
			"upgradePackages": true,
			"nonFreePackages": true,
			"username": "vscode",
			"userUid": "automatic",
			"userGid": "automatic"
		},
		"ghcr.io/devcontainers/features/docker-outside-of-docker:1.6.0": {
			"moby": false,
			"installDockerBuildx": true,
			"version": "latest",
			"dockerDashComposeVersion": "v2"
		},
		"ghcr.io/devcontainers/features/nix:1.3.0": {
			// "multiUser": false, // multi user seems not working properly as default profile is not created
			"extraNixConfig": "experimental-features = nix-command flakes",
			"packages": "nix-output-monitor"
		},
		"ghcr.io/devcontainers-extra/features/direnv:1.0.2": {}
	},
	"remoteUser": "vscode",
	"workspaceFolder": "/workspaces/atlas",
	"onCreateCommand": "nix develop --command bash -c 'echo ðŸ—¹ Nix environment successfully built'"
}
