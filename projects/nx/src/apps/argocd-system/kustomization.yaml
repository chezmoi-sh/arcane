---
apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
namespace: argocd-system

resources:
  - cluster-configuration.applicationset.yaml
  - ../../../../../catalog/kustomize/cert-manager/applicationset.argoproj.io
  - ../../../../../catalog/kustomize/external-secrets-operator/applicationset.argoproj.io

patches:
  - patch: |-
      - op: replace
        path: /spec/template/spec/project
        value: infrastructure
      - op: replace
        path: /spec/template/spec/source/repoURL
        value: https://github.com/chezmoi-sh/atlas.git
      - op: replace
        path: /spec/template/spec/source/targetRevision
        value: wip/iron-age
      - op: replace
        path: /spec/template/spec/syncPolicy
        value:
          automated:
            prune: true
            selfHeal: true
          syncOptions:
            - CreateNamespace=true
            - Delete=confirm
            - Prune=confirm
            - ServerSideApply=true
    target:
      kind: ApplicationSet
